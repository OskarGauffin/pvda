<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pvutils">
<title>Disproportionality_analysis • pvutils</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Disproportionality_analysis">
<meta property="og:description" content="pvutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pvutils</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Disproportionality_analysis.html">Disproportionality_analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Disproportionality_analysis</h1>
            
      
      
      <div class="d-none name"><code>Disproportionality_analysis.Rmd</code></div>
    </div>

    
    
<p>During the life cycle of a medicinal product, knowledge of the safety
profile continues to accumulate beyond market introduction. Spontaneous
reporting of adverse events through means of individual case safety
reports remains an important part of this safety monitoring.</p>
<p>Given a large set of reports covering a multitude of drugs and
adverse events, disproportionality analysis is a data driven framework
to identify drug-event-combinations of potential interest for further
qualitative manual case-by-case assessment. The pvutils package provides
three estimators, the proportional reporting rate (PRR), the reporting
odds ratio (ROR) and the information component (IC).</p>
<div class="section level3">
<h3 id="disproportionality-analysis-for-a-specific-drug-event-combination">Disproportionality analysis for a specific drug-event
combination<a class="anchor" aria-label="anchor" href="#disproportionality-analysis-for-a-specific-drug-event-combination"></a>
</h3>
<p>A first use-case for these functions is to provide a way to calculate
confidence or credibility intervals for a specific
drug-event-combination, where you already know the number of observed
reports, and other required counts such as the database total count,
number of reports with the exposure and number of reports with the
event.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oskargauffin.github.io/pvutils/">pvutils</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Under development. Report issues at https://github.com/OskarGauffin/pvutils</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/prr.html">prr</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="fl">10</span>, n_drug <span class="op">=</span> <span class="fl">1000</span>, n_event_prr <span class="op">=</span> <span class="fl">200</span>, n_tot_prr <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   prr2.5    prr prr97.5</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>  0.266 0.000<span style="text-decoration: underline;">2</span>   0.940</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ror.html">ror</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">10</span>, b <span class="op">=</span> <span class="fl">20</span>, c <span class="op">=</span> <span class="fl">200</span>, d <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   ror2.5   ror ror97.5</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   11.6    25    54.1</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ic.html">ic</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="fl">10</span>, exp <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##     ic2.5    ic ic97.5</span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000;">0.097</span><span style="color: #BB0000; text-decoration: underline;">3</span> 0.933   1.69</span></span></code></pre>
<p>For further details on the specific input parameters, consult the
documentation of each function.</p>
</div>
<div class="section level3">
<h3 id="disproportionality-analysis-from-report-level-data">Disproportionality analysis from report-level data<a class="anchor" aria-label="anchor" href="#disproportionality-analysis-from-report-level-data"></a>
</h3>
<p>If the aim is to screen a wide range of drug-event pairs from
report-level data using disproportionality analysis, this is handled
through the function .</p>
<p>The package contains a simulated data set ‘drug_event_df’. For
simplicity, drugs are named Drug_A - Drug_Z, and events are named
Event_1 - Event_1000. Further details on the proportions of each drug
and event are described in the data object (execute ). We pass the data
to a function that calculates expected counts, and then to a function
which adds columns contaning disproportionality.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># drug_event_df |&gt;</span></span>
<span><span class="co">#   add_expected_counts() |&gt;</span></span>
<span><span class="co">#   add_disproportionality()</span></span></code></pre></div>
<p>We will now step through these steps in detail.</p>
<div class="section level4">
<h4 id="passing-a-correctly-structured-input-data">Passing a correctly structured input data<a class="anchor" aria-label="anchor" href="#passing-a-correctly-structured-input-data"></a>
</h4>
<p>It is important that the report-level data is structured correctly.
Every line in the passed data frame corresponds to a drug-event pair
from a report.</p>
<p>In the drug_event_df-example data, the first three rows of
drug_event_df are from the same report, with report_id = 1. The first
row reports a Drug_D and an adverse event named Event_5.The next three
rows are from another report, where for instance drug B has been
reported for two different events, event 15 and event 33.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drug_event_df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##   report_id drug   event    group</span></span>
<span><span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>         1 Drug_A Event_23     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>         1 Drug_D Event_6      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>         1 Drug_E Event_8      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>         1 Drug_I Event_9      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>         2 Drug_B Event_2      0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>         2 Drug_G Event_13     0</span></span></code></pre>
<p>For completeness, note that if the same drug-event pair occurs
several times in one report, these drug-event pair contributes to counts
only once. That is, an observed count of five means that there were five
different reports containing the drug-event-pair, not e.g. that a single
report contained the same drug-event pair five times.</p>
</div>
<div class="section level4">
<h4 id="counting-the-expected">Counting the expected<a class="anchor" aria-label="anchor" href="#counting-the-expected"></a>
</h4>
<p>The details of PRR, RRR and IC are documented within each function,
but overall one can note that all expected counts are derived from the
same contingency table (including marginal sums) of those who did and
did not have the drug, and the adverse event respectively.</p>
<p>The -function has a single parameter, that can be used to turn off
calculation of expected counts for specific estimators. Note that IC by
tradition uses expected counts referred to as the Relative Reporting
Rate (RRR).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># drug_event_df |&gt;</span></span>
<span><span class="co">#   add_expected_counts(expected_count_estimators = c("prr", "ror", "rrr")) |&gt;</span></span>
<span><span class="co">#   head(1)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-the-disproportionality-estimators">Adding the disproportionality estimators<a class="anchor" aria-label="anchor" href="#adding-the-disproportionality-estimators"></a>
</h4>
<p>The function has a parameter, which by default includes IC, PRR and
ROR. If not all of those are wanted, just pass the desired estimators
instead.</p>
<p>The function has two parameters. One is the , by default set to 3,
which is sometimes referred to as “rule of three”. This sets ROR and
PRR-values to NA if the observed count is less than the specified N. For
completeness, note that the default shrinkage in the IC acts as a built
in ‘rule of 3’, i.e. the shrinkage of +0.5 prevents the lower bound to
exceed 0 at the default significance level of 95%.</p>
<p>The second parameter controls the rounding of non-count values in the
output, including all expected counts, uncertainty bounds and point
estimates. By default 2 digits are kept.</p>
<p>In short, the add_disproportionality is a wrapper around ror, prr and
ic. For further details around those estimators, see the documentation
of corresponding function.</p>
</div>
</div>
<div class="section level2">
<h2 id="subgroup-analysis">Subgroup analysis<a class="anchor" aria-label="anchor" href="#subgroup-analysis"></a>
</h2>
<p>As the disproportionality builds the comparator from the passed data,
any subgroup analysis of e.g. specific age groups is achieved by
filtering out the group of interest, and then passing it to
<code>da</code>.</p>
</div>
<div class="section level2">
<h2 id="execution-speed">Execution speed<a class="anchor" aria-label="anchor" href="#execution-speed"></a>
</h2>
<p>The data.table-package (through dtplyr) is used for fast execution. A
test of the execution speed was made using the <code>vaers</code> R
package, available on <a href="https://gitlab.com/iembry/vaers.git" class="external-link">gitlab</a>. The
<code>vaers</code> package contains data from VAERS from years 1990 -
2018, resulting in 4 146 778 rows to be processed by <code>da</code> in
<code>pvutils</code>. Execution on a regular laptop took less than 7
seconds.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Oskar Gauffin.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
